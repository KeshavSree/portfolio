---
import Layout from '../layouts/Layout.astro';
import GradientBackground from '../components/GradientBackground';
import TimelineItem from '../components/TimelineItem.astro';
---

<Layout>
	<GradientBackground client:only="react" />

	<nav id="sidebar">
		<a href="#experience" data-section="experience">Experience</a>
		<a href="#projects" data-section="projects">Projects</a>
		<a href="#education" data-section="education">Education</a>
		<a href="#contact" data-section="contact">Contact</a>
	</nav>

	<main>
		<div class="intro" id="intro">
			<h1 id="name"></h1>
			<p id="first-para"></p>
		</div>

		<section id="experience">
			<div class="timeline">
				<TimelineItem
					title="Project Manager"
					date="Jan 2026 — Present"
					company="Mead Johnson @ Data Mine Purdue"
					description="Led development of a research database for the R&D division and facilitated Agile methodology across the team."
				/>
				<TimelineItem
					title="Measurement Software Engineer"
					date="Sep 2025 — Present"
					company="Continuity Pharma"
					description="Built a full-stack real-time monitoring system with sub-second latency, processing over 2 million data points daily with FDA-compliant traceability."
				/>
				<TimelineItem
					title="Software Engineering Intern"
					date="Jun 2025 — Aug 2025"
					company="Spring Education Group — Schools of Paragon"
					description="Built an educational analytics dashboard with Next.js and FastAPI, now used across 2 departments, 5+ classes and 200+ students."
				/>
				<TimelineItem
					title="Software Developer"
					date="Jan 2025 — Present"
					company="KiharaLab"
					description="Integrated sequence alignment tools with a FastAPI — Next.js web server, enabling 4x faster queries and reducing codebase size by 33%."
				/>
			</div>
		</section>

		<section id="projects">
			<p>
				Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do
				eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim
				ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut
				aliquip ex ea commodo consequat.
			</p>
		</section>

		<section id="education">
			<div class="edu-block">
				<div class="edu-header">
					<h3>Purdue University</h3>
					<span class="edu-date">Expected Dec 2027</span>
				</div>
				<p class="edu-degree">B.S. Data Science (Computer Science) — GPA: 3.71</p>
				<p class="edu-courses">Data Structures & Algorithms, Object-Oriented Programming, Foundations of Computer Science, Introduction to Machine Learning, Numerical Methods</p>
			</div>
			<div class="skills-block">
				<div class="skill-row"><span class="skill-label">Languages</span><span class="skill-value">Python, Java, JavaScript, HTML, Bash, MATLAB, R, C++, Swift, SQL</span></div>
				<div class="skill-row"><span class="skill-label">Frameworks</span><span class="skill-value">React, Next.js, Node.js, FastAPI, Django, Flask, Tailwind CSS</span></div>
				<div class="skill-row"><span class="skill-label">Libraries</span><span class="skill-value">Pandas, Numpy, Scikit-learn, Tensorflow, Pytorch, Matplotlib, Seaborn</span></div>
				<div class="skill-row"><span class="skill-label">Tools</span><span class="skill-value">GCP, MySQL, PostgreSQL, MongoDB, Docker, Kubernetes, Git, CI/CD, Vercel, Linux</span></div>
			</div>
		</section>

	</main>

	<section id="contact">
		<p>
			Temporibus autem quibusdam et aut officiis debitis aut rerum
			necessitatibus saepe eveniet ut et voluptates repudiandae sint et
			molestiae non recusandae.
		</p>
		<p>
			Itaque earum rerum hic tenetur a sapiente delectus, ut aut
			reiciendis voluptatibus maiores alias consequatur aut perferendis
			doloribus asperiores repellat.
		</p>
	</section>
</Layout>

<style>
	main {
		position: relative;
		z-index: 1;
		max-width: 55%;
		padding: 0 4rem 6rem 7rem;
	}

	/* Intro — vertically centered, full viewport */
	.intro {
		min-height: 100vh;
		display: flex;
		flex-direction: column;
		justify-content: center;
		margin-bottom: 8rem;
	}

	h1 {
		font-size: 3rem;
		margin-bottom: 2rem;
		min-height: 1.2em;
	}

	.cursor {
		display: inline-block;
		width: 0.6em;
		height: 1.15em;
		background: #fff;
		vertical-align: text-bottom;
		animation: blink 1s step-end infinite;
	}

	@keyframes blink {
		50% { opacity: 0; }
	}

	p {
		font-size: 1.125rem;
		line-height: 1.8;
		margin-bottom: 1.5rem;
		opacity: 0.85;
	}

	#first-para {
		min-height: 1.5em;
	}

	/* Sidebar */
	#sidebar {
		position: fixed;
		left: 2rem;
		top: 50%;
		transform: translateY(-50%);
		z-index: 10;
		display: flex;
		flex-direction: column;
		gap: 1.25rem;
	}

	#sidebar a {
		font-family: monospace;
		font-size: 0.75rem;
		color: #fff;
		text-decoration: none;
		opacity: 0.3;
		transition: opacity 0.3s ease;
		cursor: pointer;
		letter-spacing: 0.05em;
	}

	#sidebar a:hover {
		opacity: 0.7;
	}

	#sidebar a.active {
		opacity: 1;
	}

	/* Sections — compact with moderate spacing */
	section {
		padding-top: 6rem;
		margin-bottom: 6rem;
	}

	section:last-child {
		margin-bottom: 0;
	}

	#contact {
		position: relative;
		z-index: 1;
		max-width: 35%;
		margin-left: auto;
		padding-right: 7rem;
		text-align: right;
	}

	/* Section paragraphs hidden until revealed */
	section > p {
		transform: translateY(100vh);
		transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
	}

	section > p.fade-in {
		opacity: 0.85;
		transform: translateY(0);
	}

	/* Education & Skills */
	.edu-block, .skills-block {
		transform: translateY(100vh);
		transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
	}

	.edu-block.fade-in, .skills-block.fade-in {
		opacity: 1;
		transform: translateY(0);
	}

	.edu-header {
		display: flex;
		justify-content: space-between;
		align-items: baseline;
		gap: 1rem;
		margin-bottom: 0.25rem;
	}

	.edu-header h3 {
		font-size: 1.2rem;
		font-weight: 600;
		margin: 0;
	}

	.edu-date {
		font-size: 0.95rem;
		opacity: 0.5;
		white-space: nowrap;
	}

	.edu-degree {
		font-size: 1.05rem;
		opacity: 0.7;
		margin-bottom: 0.5rem;
	}

	.edu-courses {
		font-size: 0.95rem;
		opacity: 0.5;
		margin-bottom: 0;
	}

	.skills-block {
		margin-top: 2.5rem;
	}

	.skill-row {
		display: flex;
		gap: 1.5rem;
		margin-bottom: 0.5rem;
		font-size: 1rem;
		line-height: 1.6;
	}

	.skill-label {
		opacity: 0.5;
		white-space: nowrap;
		min-width: 6rem;
	}

	.skill-value {
		opacity: 0.8;
	}

	/* Timeline */
	.timeline {
		position: relative;
		padding-left: 5rem;
	}

	.timeline::before {
		content: '';
		position: absolute;
		left: 1.75rem;
		top: 0;
		bottom: 0;
		width: 1px;
		background: rgba(255, 255, 255, 0.15);
	}

</style>

<script>
	const nameText = 'Keshav Sreekantham';
	const firstParaText = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.';

	const h1 = document.getElementById('name')!;
	const firstPara = document.getElementById('first-para')!;

	const cursor = document.createElement('span');
	cursor.className = 'cursor';

	const TYPING_SPEED = 50;

	// Scroll to top on load so intro is visible after reload
	window.scrollTo(0, 0);

	// Zone order: intro is index 0, then sections 1-4
	const introEl = document.getElementById('intro')!;
	const sectionIds = ['experience', 'projects', 'education', 'contact'];
	const sectionEls = sectionIds.map((id) => document.getElementById(id)!);
	const zones: HTMLElement[] = [introEl, ...sectionEls];
	const navLinks = document.querySelectorAll<HTMLAnchorElement>('#sidebar a');

	const revealed = new Set<string>();

	function dispatchGradientTransition(zoneIndex: number) {
		window.dispatchEvent(
			new CustomEvent('gradient-transition', {
				detail: { zoneIndex },
			})
		);
	}

	function typeInto(el: HTMLElement, text: string, speed: number): Promise<void> {
		return new Promise((resolve) => {
			el.textContent = '';
			el.appendChild(cursor);
			let i = 0;
			function next() {
				if (i < text.length) {
					el.insertBefore(document.createTextNode(text[i]), cursor);
					i++;
					setTimeout(next, speed);
				} else {
					resolve();
				}
			}
			next();
		});
	}

	function revealSection(sectionId: string) {
		if (revealed.has(sectionId)) return;
		revealed.add(sectionId);
		const section = document.getElementById(sectionId);
		if (!section) return;
		const items = section.querySelectorAll(':scope > p, .timeline-item, .edu-block, .skills-block');
		items.forEach((el, i) => {
			setTimeout(() => el.classList.add('fade-in'), i * 120);
		});
	}

	function revealSectionInstant(sectionId: string) {
		if (revealed.has(sectionId)) return;
		revealed.add(sectionId);
		const section = document.getElementById(sectionId);
		if (!section) return;
		const items = section.querySelectorAll(':scope > p, .timeline-item, .edu-block, .skills-block');
		items.forEach((el) => el.classList.add('fade-in'));
	}

	// Sidebar nav click — instantly reveal intermediate sections, scroll to target
	navLinks.forEach((link) => {
		link.addEventListener('click', (e) => {
			e.preventDefault();
			const targetId = link.dataset.section!;
			const targetIdx = sectionIds.indexOf(targetId);
			const target = sectionEls[targetIdx];

			// Instantly reveal all sections up to target
			for (let i = 0; i < targetIdx; i++) {
				revealSectionInstant(sectionIds[i]);
			}
			// Target section gets the stagger reveal
			revealSection(sectionIds[targetIdx]);

			// Dispatch gradient transition (zone 0 = intro, sections start at 1)
			dispatchGradientTransition(targetIdx + 1);

			// Smooth scroll natively
			target.scrollIntoView({ behavior: 'smooth' });
		});
	});

	// Single observer — gradient transitions, nav highlighting, and section reveals
	// all fire at the same moment (when section enters top ~40% of viewport)
	const activeObserver = new IntersectionObserver(
		(entries) => {
			entries.forEach((entry) => {
				if (entry.isIntersecting) {
					const id = entry.target.id;
					// Highlight nav
					navLinks.forEach((link) => {
						link.classList.toggle('active', link.dataset.section === id);
					});
					// Dispatch gradient transition
					const zoneIndex = id === 'intro'
						? 0
						: sectionIds.indexOf(id) + 1;
					dispatchGradientTransition(zoneIndex);
					// Reveal section content in sync with gradient
					revealSection(id);
				}
			});
		},
		{ rootMargin: '-30% 0px -60% 0px' }
	);
	// Observe all zones including intro
	zones.forEach((zone) => activeObserver.observe(zone));

	// Typing intro animation
	async function run() {
		await typeInto(h1, nameText, TYPING_SPEED);
		await new Promise((r) => setTimeout(r, 400));
		await typeInto(firstPara, firstParaText, 12);
		cursor.remove();
	}

	setTimeout(run, 500);
</script>
